// Generated by CoffeeScript 1.4.0
(function(){this.hsvString=function(e,t,n){var r;return r=hsvToRgb(e,t,n),colorToString([Math.floor(r[0]),Math.floor(r[1]),Math.floor(r[2])])},this.randomColor=function(){var e;return e=hsvToRgb(Math.random()*.1+.4,.8,.9),[Math.floor(e[0]),Math.floor(e[1]),Math.floor(e[2])]},this.colorToString=function(e){return"rgb("+e[0]+", "+e[1]+", "+e[2]+")"},this.randomColorString=function(){var e;return e=randomColor(),colorToString(e)},this.clamp=function(e){return Math.max(Math.min(e,1),0)},this.mediate=function(e,t,n){return e+(t-e)*n},this.colorToString=function(e){return"hsla("+(e.h-Math.floor(e.h))*360+", "+clamp(e.s)*100+"%, "+clamp(e.l)*100+"%, 1.0)"},NAN.Grid=function(){function e(e,t,n){this.x=e,this.y=t,this.game=n,this.mouse=this.game.mouse,this.id=this.game.gridId,this.deltaX=0,this.game.gridId+=1,this.exist=!0,this.value=Math.floor(Math.random()*10),this.selected=!1,this.color=this.getColor(),this.remainedTime=-1}return e.prototype.cleaned=function(){return this.remainedTime>=0},e.prototype.clean=function(){return this.remainedTime=30},e.prototype.moveTo=function(e,t){return this.x=e,this.y=t},e.prototype.getColor=function(){var e;return e={},e.s=.5,this.selected?e.h=.3:e.h=.8,this.value==="NAN"?(e.h+=.1,e.l=.6):e.l=this.value*.01+.3,e},e.prototype.getPosition=function(){var e,t,n,r;return e={x:this.game.gridXOffset+this.x*this.game.gridHeight,y:this.game.gridYOffset+this.y*this.game.gridWidth},this.cleaned()?(t=.5+ -Math.cos(Math.PI*(30-this.remainedTime)/30)/2,n=mediate(e.x,this.game.score.position.x,t),r=mediate(e.y,this.game.score.position.y-this.game.gridWidth/2,t),{x:n,y:r}):e},e.prototype.getElement=function(){return $("#square-"+this.id)},e.prototype.isConnecting=function(e){var t;return t=Math.abs(e.x-this.x)+Math.abs(e.y-this.y)===1,t},e.prototype.init=function(){var e=this;return $("#container").append("<div class='square' id='square-"+this.id+"'></div>"),this.position=this.getPosition(),this.getElement().css("background-color",colorToString(this.color)),this.getElement().append("<div class='number'>"+this.value+"</p>"),this.getElement().hide(),this.getElement().show(500),this.getElement().mouseover(function(){return e.mouseOver(),!1}),this.getElement().mousedown(function(){return e.mouseDown(),!1}),this.getElement().mouseup(function(){return e.mouseUp(),!1}),this.update()},e.prototype.update=function(){var e;return this.cleaned()&&(this.remainedTime===0&&(this.exist=!1),this.getElement().css("opacity",Math.pow(this.remainedTime/30,3)),this.remainedTime-=1),this.color=this.getColor(),this.deltaX!==0&&(e=Math.min(this.deltaX,10),this.deltaX-=e,this.position.x+=e),this.cleaned()&&(this.position=this.getPosition()),this.position!==this.lastPosition&&(this.getElement().css("top",""+this.position.x+"px"),this.getElement().css("left",""+this.position.y+"px")),this.lastPosition={x:this.position.x,y:this.position.y},this.color!==this.lastColor&&this.getElement().css("background-color",colorToString(this.color)),this.lastColor=this.color},e.prototype.mouseDown=function(){if(this.mouse.state==="none")return this.mouse.beginPath(),this.mouse.addGrid(this)},e.prototype.mouseOver=function(){if(this.mouse.state==="select")return this.mouse.addGrid(this)},e.prototype.mouseUp=function(){if(this.mouse.state==="select")return this.mouse.addGrid(this),this.mouse.endPath()},e}(),NAN.Mouse=function(){function e(){this.path=[],this.state="none"}return e.prototype.checkPath=function(){var e,t,n,r;t=!0,this.path.length<2&&(t=!1);for(e=n=0,r=this.path.length-1;0<=r?n<r:n>r;e=0<=r?++n:--n)this.path[e].grid.isConnecting(this.path[e+1].grid)===!1&&(t=!1);return t},e.prototype.evaluatePath=function(){var e,t,n,r,i,s;t="",s=this.path;for(r=0,i=s.length;r<i;r++)e=s[r],n=e.grid.value,t+=n.toString();return t},e.prototype.beginPath=function(){return this.path=[],this.state="select"},e.prototype.endPath=function(){var e,t,n,r,i,s,o,u,a;if(this.state==="none")return;if(this.checkPath()){n=this.evaluatePath(),r=$.analyzer.analyze(n),$.numberShow=new NAN.NumberShow({n:n,descriptions:r.descriptions.filter(function(e){return e!==null&&e!==""}).join("<br>"),score:r.score}),$.game.score.addValue(r.score);for(e=i=0,u=this.path.length;0<=u?i<u:i>u;e=0<=u?++i:--i)t=this.path[e],t.grid.clean()}a=this.path;for(s=0,o=a.length;s<o;s++)t=a[s],t.grid.selected=!1;return this.state="none",this.path=[]},e.prototype.addGrid=function(e){var t,n,r,i,s;if(this.path.length>=9)return;if(this.path.length===0&&e.value===0)return;t=!1,s=this.path;for(r=0,i=s.length;r<i;r++)n=s[r],n.x===e.x&&n.y===e.y&&(t=!0);if(!t)if(this.path.length===0||this.path[this.path.length-1].grid.isConnecting(e))return e.selected=!0,n={x:e.x,y:e.y,grid:e},this.path.push(n)},e}(),NAN.Score=function(){function e(){this.value=0,this.displayedValue=0,this.position={x:20,y:$("#container").width()/2}}return e.prototype.addValue=function(e){return this.value+=e},e.prototype.update=function(){var e;return e=(this.value-this.displayedValue)*.1,this.displayedValue+=e,$("#score").html(""+Math.floor(this.displayedValue+.3))},e}(),NAN.NumberShow=function(){function e(e){this.time=0,this.finished=!1,this.getElement().show(),this.getElement().animate({opacity:"0.95"},400),this.getElementNumber().html(e.n),this.getElementScore().html(e.score.toString()+" points");if(e.descriptions===null||e.descriptions==="")e.descriptions="Not Interesting";this.getElementDescriptions().html(e.descriptions)}return e.prototype.getElement=function(){return $("#number-show")},e.prototype.getElementNumber=function(){return $("#number-show-number")},e.prototype.getElementScore=function(){return $("#number-show-score")},e.prototype.getElementDescriptions=function(){return $("#number-show-descriptions")},e.prototype.update=function(){var e=this;this.time+=1;if(this.time>50)return this.getElement().animate({opacity:"0.0"},400),setTimeout(function(){return e.getElement().hide(200)},400),this.finished=!0},e}(),NAN.Game=function(){function e(){var e,t,n;$.backgroundBlockId=0,this.background=new NAN.Background,this.score=new NAN.Score,this.gridId=0,this.init(),this.gridWidth=60,this.gridHeight=60,this.numGridColumns=10,this.numGridRows=8,this.numGrids=this.numGridColumns*this.numGridRows,this.gridXOffset=90,this.gridYOffset=(680-this.numGridColumns*this.gridWidth)/2,this.grids=[],this.mouse=new NAN.Mouse,this.paused=!0,this.timeLeft=100,this.gridQueue=[];for(e=t=0,n=this.numGridRows;0<=n?t<n:t>n;e=0<=n?++t:--t)this.grids[e]=[]}return e.prototype.newGrid=function(e,t){var n;return n=new NAN.Grid(e,t,this),this.grids[e][t]=n,n.init(),this.gridQueue.push(n)},e.prototype.init=function(){return this.time=0},e.prototype.movementEnd=function(){var e,t,n,r,i,s,o,u;t=!0,u=this.grids;for(r=0,s=u.length;r<s;r++){n=u[r];for(i=0,o=n.length;i<o;i++)e=n[i],e!==null&&e.deltaX!==0&&(t=!1)}return t},e.prototype.nextFrame=function(){var e,t,n,r,i,s,o,u,a;o=function(){a=[];for(var e=0,t=this.numGridRows;0<=t?e<t:e>t;0<=t?e++:e--)a.push(e);return a}.apply(this).reverse(),u=[];for(n=0,i=o.length;n<i;n++)e=o[n],u.push(function(){var n,r,i;i=[];for(t=n=0,r=this.numGridColumns;0<=r?n<r:n>r;t=0<=r?++n:--n)this.grids[e][t]===null||!this.grids[e][t].exist?e>0&&this.grids[e-1][t]!==null?(this.grids[e-1][t].deltaX+=this.gridHeight,this.grids[e][t]=this.grids[e-1][t],this.grids[e-1][t].moveTo(e,t),i.push(this.grids[e-1][t]=null)):e===0?i.push(this.newGrid(e,t)):i.push(void 0):i.push(void 0);return i}.call(this));return u},e.prototype.updateGrids=function(){var e,t,n,r,i;t=[],i=this.gridQueue;for(n=0,r=i.length;n<r;n++)e=i[n],e===null||e.exist===!1?0:(e.update(),t.push(e));return this.gridQueue=t},e.prototype.getPaused=function(){return this.time<=100?!0:$.numberShow&&!$.numberShow.finished?!0:this.movementEnd()?!1:!0},e.prototype.update=function(){var e,t,n,r;this.paused=this.getPaused();if(this.time<this.numGridRows){e=this.time;for(t=n=0,r=this.numGridColumns;0<=r?n<r:n>r;t=0<=r?++n:--n)this.newGrid(e,t)}else this.nextFrame();return this.updateGrids(),this.score.update(),this.background.update(),this.time+=1,$.numberShow&&($.numberShow.update(),$.numberShow.finished&&($.numberShow=null)),this.paused||(this.timeLeft-=.03),$("#progressbar").attr("value",""+this.timeLeft)},e}(),$(document).ready(function(){var e;return e=1,$("#number-show").hide(),$("#number-show").css("opacity","0.0"),$.analyzer=new window.NAN.Analyzer,$("#title").animate({top:"-=400px"},0),$("#title").animate({top:"+=400px"},1900*e),$("#how-to-play").slideUp(0),$("#container").animate({top:"+=700px"},0),$("#container").animate({top:"-=700px"},1900*e),$.game=new NAN.Game,setTimeout(function(){return setInterval(function(){return $.game.update()},20)},2e3*e),setTimeout(function(){return $("#title-1").animate({fontSize:"90px"},500*e),$("#title-2").slideUp(500*e),$("#title-3").animate({fontSize:"49px"},500*e)},3e3*e),$("body").mouseup(function(){return $.game.mouse.endPath()}),setTimeout(function(){return $("#how-to-play").slideDown(700)},4e3*e)})}).call(this);